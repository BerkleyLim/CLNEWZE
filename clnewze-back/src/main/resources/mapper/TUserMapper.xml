<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.clnewze.back.clnewzeback.mapper.TUserMapper">
  
  <!-- 간편 로그인 -->
  <select id="findByIdAndPassword" resultType="T_user">
    select * from t_user
    where id=#{id} and password=#{password}
  </select>

  <!-- 유저명 검색 -->
  <select id="findOneWithAuthoritiesById" resultType="T_user">
    select
    u1_0.uno,
    u1_0.id,
    u1_0.activated,
    u1_0.user_name,
    json_arrayagg(a1_1.authority_name) as typeOfStringAuthorities,
    -- concat('\'',json_arrayagg(concat('\'',json_object('\"authority_name\"', concat('\"',a1_1.authority_name,'\"')),'\'')),'\'') as authorities,
    u1_0.nick_name,
    u1_0.password
    from
        t_user u1_0
    left join
        (user_authority a1_0
    join
        authority a1_1
            on a1_1.authority_name=a1_0.authority_name)
        on u1_0.uno=a1_0.uno
    where 1=1
    <if test="id != 'null'">
      and u1_0.id=#{id};
    </if>
  </select>
  <!-- select json_arrayagg(a1_1.authority_name) as authorities from -->


  <!-- 회원 가입 -->
  <insert id="signUp">
    insert
    into
        "user"
        (activated, nick_name, password, user_name, user_id)
    values
        (?, ?, ?, ?, default);

    insert
    into
        user_authority
        (user_id, authority_name)
    values
        (?, ?)   
  </insert>
  
</mapper>